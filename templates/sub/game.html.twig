<html lang="ru">
<head>
    <title>Clow</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
            integrity="sha256-4+XzXVhsDmqanXGHaHvgh1gMQKX40OUvDEBTu8JcmNs=" crossorigin="anonymous"></script>

    <!--    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js" integrity="sha384-7+zCNj/IqJ95wo16oMtfsKbZ9ccEh31eOz1HGyDuCQ6wgnyJNSYdrPa03rtR1zdB" crossorigin="anonymous"></script>-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/reconnecting-websocket/1.0.0/reconnecting-websocket.js"></script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css"
          integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3"
            crossorigin="anonymous"></script>

    <script src="data/phaser.js"></script>
    <script src="data/index.js"></script>

    <script src="data/js/helper.js"></script>
    <script src="data/js/easy-websocket.js"></script>

</head>
<body>

<div class="modal modal-lg build-modal" tabindex="-1" role="dialog" style="">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">–°—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">

                <nav>
                    <div class="nav nav-tabs" id="nav-tab" role="tablist">
                        <button class="nav-link active" id="nav-home-tab" data-bs-toggle="tab"
                                data-bs-target="#nav-home" type="button" role="tab" aria-controls="nav-home"
                                aria-selected="true">–£–ª—É—á—à–µ–Ω–∏–µ –∑–∞–º–∫–∞
                        </button>
                        <button class="nav-link" id="nav-profile-tab" data-bs-toggle="tab" data-bs-target="#nav-profile"
                                type="button" role="tab" aria-controls="nav-profile" aria-selected="false">–°—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ
                        </button>
                    </div>
                </nav>
                <div class="tab-content" id="nav-tabContent">
                    <div class="list-group">
                        <div class="tab-pane fade show active" id="nav-home" role="tabpanel"
                             aria-labelledby="nav-home-tab">

                            <a href="#" class="list-group-item list-group-item-action flex-column align-items-start justify-content-between">
                                <div class="d-flex w-100 justify-content-between">
                                    <h6 class="mb-1">
                                        –ú–∏–Ω–∏—Å—Ç–µ—Ä—Å—Ç–≤–æ –ê—Ä–º–∏–∏
                                    </h6>
                                    <small>
                                        <span class="badge bg-secondary rounded-pill">—Å—Ç—Ä–æ–∏—Ç—å—Å—è –±—É–¥–µ—Ç 2 –≥–æ–¥–∞</span>
                                        <span class="badge bg-primary rounded-pill">—Å—Ç–æ–∏—Ç 680 üí∞</span>
                                    </small>
                                </div>
                                <p class="mb-1">–ü–æ–∑–≤–æ–ª—è–µ—Ç —Å—Ç—Ä–æ–∏—Ç—å –≤–æ–π—Å–∫–æ–≤—ã–µ —á–∞—Å—Ç–∏ –∏ —É–ø—Ä–∞–≤–ª—è—Ç—å –∞—Ä–º–∏–µ–π</p>
                            </a>

                            <a href="#" class="list-group-item list-group-item-action flex-column align-items-start justify-content-between">
                                <div class="d-flex w-100 justify-content-between">
                                    <h6 class="mb-1">
                                        –ú–∏–Ω–∏—Å—Ç–µ—Ä—Å—Ç–≤–æ –ø—Ä–∏—Ä–æ–¥–Ω—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤
                                    </h6>
                                    <small><span class="badge bg-primary rounded-pill">1299 üí∞</span></small>
                                </div>
                                <p class="mb-1">–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ–±—ã—á–∏ –Ω–µ—Ñ—Ç–∏ –∏ –≥–∞–∑–∞</p>
                            </a>
                        </div>
                        <div class="tab-pane fade" id="nav-profile" role="tabpanel" aria-labelledby="nav-profile-tab">
                            ...
                        </div>
                    </div>
                </div>


            </div>
        </div>
    </div>
</div>
<script>


    class EasyWebSocket {

        static init(serverIp) {
            EasyWebSocket.browserId = Identity.getBrowserId();
            EasyWebSocket.fetchWebSocket(serverIp);
            EasyWebSocket.queue = new SendQueue(EasyWebSocket.conn, EasyWebSocket.browserId)
        }

        static fetchWebSocket(serverIp) {
            EasyWebSocket.createWebSocket(serverIp);
        }

        static createWebSocket(currLocation) {

            EasyWebSocket.conn = new ReconnectingWebSocket('ws://' + currLocation);

            EasyWebSocket.conn.onopen = function () {
                console.info("Connection established!");
            };

            EasyWebSocket.conn.onerror = function () {
                console.info("Connection error!");
            };

            EasyWebSocket.conn.onclose = function () {
                console.info("Connection close!");
            };

            EasyWebSocket.conn.onmessage = function (e) {
                EasyWebSocket.receiveMessage(e);
            };
        }

        static receiveMessage(e) {
            let data = JSON.parse(e.data);
            let type = data['type'];

            EasyWebSocket.handleMessage(type, data);
        }

        static handleMessage(type, data) {
            console.log(':message:',type, data);
        }
    }

    easyFetch('getServerIp.php', {}).then(function (serverIp) {
        EasyWebSocket.init(serverIp);
        EasyWebSocket.queue.sendNow('type1', {'msg': 'message1'});
    });


</script>

{#<script>#}
{#    function NotifServer(){#}
{#        let notif = new EasyWebSocket("ws://127.0.0.1:9090");#}

{#        notif.onmessage = function (event) {#}
{#            console.log(event.data);#}
{#            $('.content').append('<p>'+ event.data +'</p>');#}

{#        }#}

{#        notif.onopen = function() {#}
{#            $('.content').append('<p> >>> Connected</p>');#}
{#            let token_user = '{{ token }}';#}
{#            let authElements = "{\"userData\":\""+token_user+"\"}";#}
{#            notif.send(authElements);#}
{#        }#}

{#        notif.onerror = function(error) {#}
{#            $('.content').append('<p> >>> Error...</p>');#}
{#            //alert('error');#}
{#        }#}
{#    }#}

{#    NotifServer();#}
{#</script>#}


<script>
    document.addEventListener('start', e => {
        console.log('–û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏—è start –Ω–∞ document!');
    });

</script>

</body>
</html>